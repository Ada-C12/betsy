<section>
  <h1 class="card-title"> <%= @product.name %></h1>
  <%= product_img_link(product: @product, img_url: @product.img_url, product_class: "show-product-img")%> 
    <h2> $<%= @product.price %> </h2>
    <h4> <%= @product.description %> </h4>
    <h5> Stock: <%= @product.stock %> </h5>
    <%= form_with model: OrderItem, url: product_order_items_path(@product.id) do |f| %>
      <%= f.label :quantity, class: "col-sm-2 col-form-label"%>
      <%= f.text_field :quantity, class: "form-control" %>
      <%= f.submit "add to cart", class: "btn btn-primary" %>
    <% end %>


    <% merchant = User.find_by(id: @product.user_id)%>
    <h5 class="card-text"> Merchant:<%= link_to @product.user.username, user_path(@product.user.id)  %></h5> 
    <h5>
      Categories: 
      <% categories = @product.categories.map do |category| %>
        <%= link_to category.name, category_products_path(category.id) %>,
      <% end %>
    </h5>
</section>


<%= form_with model: Review, url: reviews_path, method: :post do |f| %>
  <%= f.label "Rating", class: "col-sm-2 col-form-label"%>
  <%= f.text_field :rating, class: "form-control" %>
  <%= f.label "Review", class: "col-sm-2 col-form-label"%>
  <%= f.text_field :description, class: "form-control" %>
  <%= f.hidden_field :user_id, :value => session[:user_id] %>
  <%= f.hidden_field :product_id, :value => @product.id %>

  <%= f.submit "Submit", class: "btn btn-primary" %>
<% end %>

<% @product.reviews.each do |review| %>
  <% if review.user %>
    <p> Reviewer: <%= review.user.username %> </p>
  <% else %>
    <p> Reviewer: Guest </p>
  <% end %>
  <p> Rating: <%= review.rating %> </p>
  <p> Review: <%= review.description %> </p>
<% end %>