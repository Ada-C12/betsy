<h2>hello, <%=@current_user.username%>!</h2>
<p>You can <strong><%=link_to "edit", edit_user_path %></strong> your profile here.</p>
Total revenue as of <%= Date.today %>:  <%= @current_user.total_earned%>

<%# ADD total revenue of all status that qualify(all status except for pending) HERE %>
<section class="user-products__container">
  <h3 class="user-products__header">Manage your products</h3>
  <table class="table">
    <thead>
      <tr>
        <th> Title</th>
        <th> Price</th>
        <th> Stock</th>
        <th> Description</th>
        <th> Category</th>
        <th> Edit </th>
      </tr>
    </thead>
    <tbody>
      <%if @current_user.products %>
        <% @current_user.products.each do |product| %>
          <tr>     
            <%= form_with model: product, method: :patch, url: product_path(product.id) do |f| %>
            <td><%= link_to product.name, product_path(product) %></td>
            <td><%= f.text_field :price%></td>
            <td><%= product.stock%></td>
            <td><%= product.description %></td>
            <td><%= product.categories.first.name %></td>
            <td><%= f.submit submit_button_label: "Edit Product"%></td>
          <% end %>
          </tr>
        <% end %>
      <% end %>
  </tbody>
  </table>
</section>

<section class="user-orders__container">
  <h3 class="user-products__header">Manage your orders</h3>
  <table class="table">
    <thead>
      <tr>
        <th> Order id</th>
        <%# #Will require a link to view individual order %>
        <th> Product</th> 
        <%# #Will require a link to the product %>
        <th> Order date</th>
        <th>
          <a class="dropdown-toggle" href="#" id="DropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Status
          </a>
          <div class="dropdown-menu" aria-labelledby="DropdownMenuLink">
            <%= link_to "All", current_user_path, class: "dropdown-item" %>
            <%= link_to "Paid", current_user_path(:status => "paid"), class: "dropdown-item" %>
            <%= link_to "Cancelled", current_user_path(:status => "cancelled"), class: "dropdown-item" %>
            <%= link_to "Completed", current_user_path(:status => "completed"), class: "dropdown-item" %>
          </div>
        </th>
        <th> Total </th>
        <th> Category</th>
      </tr>
    </thead>
    <tbody>
    <% if @current_user.products %>
      <% total_revenue = 0 %>
      <% @order_items.each do |order_item| %>
        <tr>
          <% order = order_item.order %>
          <td><%= link_to order.id, order_path(order.id) %></td>
          <td><%= link_to order_item.product.id, product_path(order_item.product.id) %></td>
          <td><%= readable_date(order.created_at) %></td>
          <td>
            <% if order.status == "paid" %>
              <a class="dropdown-toggle" href="#" id="DropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Paid
              </a>
              <div class="dropdown-menu" aria-labelledby="DropdownMenuLink">
                <%= link_to "Cancelled", cancel_order_path(order.id), method: :patch, class: "dropdown-item" %>
                <%= link_to "Completed", complete_order_path(order.id), method: :patch, class: "dropdown-item" %>
              </div>
            <% else %>
              <%= order.status.capitalize %>
            <% end %>
          </td>
          <td><%= order_item.total %>
          <td><%= order_item.product.categories.first.name %></td>
          <%# in this subtotal section, calculate the subtotal for that order item by calling the 'total' class method in Order_Item %>
        </tr>
      <% end %>
    <%end%>
    </tbody>
  </table>
</section>
<%= link_to "Back to Home", root_path, class: "btn btn-primary" %>
