<h2>hello, <%=@current_user.username%>!</h2>
<p>You can <strong><%=link_to "edit", edit_user_path %></strong> your profile here.</p>
Total revenue as of <%= readable_date(Date.today) %>: <%=currency_format(@current_user.total_earned)%>
<%if @current_user.total_earned > 0 %> 
  <%= @current_user.total_earned %>
<%else %>
  <p> You haven't sold any products yet! Why not <strong><%=link_to "add a product", new_product_path%></strong> to sell? </p>
<%end%> 
<section class="user-products__container">
  <h3 class="user-products__header">Manage your products</h3>
  <table class="table">
    <thead>
      <tr>
        <th> Product </th>
        <th> Title</th>
        <th> Price</th>
        <th> Stock</th>
        <th> Description</th>
        <th> Img url </th>
        <th> Category</th>
        <th> Active </th>
        <th> ActiveStatus </th>
        <th> Edit </th>
        <th> Delete </th>
      </tr>
    </thead>
    <tbody>
      <%if @current_user.products %>
        <% @current_user.products.each do |product| %>
          <tr>  
            <td> <%=product_img_link(product: product, img_url: product.img_url, product_class:"product-thumbnail")%></td>   
            <%= form_with model: product, method: :patch, url: product_path(product.id) do |f| %>
            <td><%= f.text_field :name%></td>
            <td><%= f.text_field :price%></td>
            <td><%= f.text_field :stock%></td>
            <td><%= f.text_field :description%></td>
            <td><%= f.text_field :img_url %>
            <%if !product.categories.empty? %>
              <td><%= product.categories.first.name %></td>
            <%else%>
              <td><p> N/A</p></td>
            <%end %>
            <td> <%= f.check_box :active %></td>
            <td> <%= product.active %>
            <td><%= f.submit "Update", submit_button_label: "Edit Product" %></td>
          <% end %>
            <td> <%= link_to "Delete", product_path(product.id ), method: :delete, data: { confirm: "Really really delete?"}, class: "btn btn-primary" %>
          </tr>
        <% end %>
      <% end %>
  </tbody>
  </table>
</section>

<section class="user-orders__container">
  <h3 class="user-products__header">Manage your orders</h3>
  <table class="table">
    <thead>
      <tr>
        <th> Order id</th>
        <%# #Will require a link to view individual order %>
        <th> Product Name</th> 
        <%# #Will require a link to the product %>
        <th> Order date</th>
        <th> Status</th>
        <th> Total </th>
        <th> Category</th>
      </tr>
    </thead>
    <tbody>
    <% if @current_user.products %>
    <% total_revenue = 0 %>
    <% @current_user.products.each do |product| %>
      <% product.order_items.each do |order_item| %>
        <tr>
          <% order = order_item.order %>
          <td><%= link_to order.id, order_path(order.id) %></td>
          <td><%= link_to product.name, product_path(product.id) %></td>
          <td><%= readable_date(order.created_at) %></td>
          <td>
            <% if order.status == "paid" %>
              <a class="dropdown-toggle" href="#" id="DropdownMenuLink" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Paid
              </a>
              <div class="dropdown-menu" aria-labelledby="DropdownMenuLink">
                <%= link_to "Cancelled", cancel_order_path(order.id), method: :patch, class: "dropdown-item" %>
                <%= link_to "Completed", complete_order_path(order.id), method: :patch, class: "dropdown-item" %>
              </div>
            <% else %>
              <%= order.status.capitalize %>
            <% end %>
          </td>
          <td><%= order_item.total %>
          <% if !product.categories.empty?%>
            <td><%= product.categories.first.name %></td>
          <% elsif %>
            <td> <p> N/A </p>
          <% end %>
        </tr>
      <% end %>
    <%end%>
    <%end%>
    </tbody>
  </table>
</section>
<%= link_to "Back to Home", root_path, class: "btn btn-primary" %>
